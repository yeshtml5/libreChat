# Package.json 스크립트 가이드

LibreChat 프로젝트의 `package.json` 스크립트 명령어들의 의미와 사용 방법에 대한 상세한 설명입니다.

## 📦 루트 Package.json 스크립트

### 🔄 업데이트 관련 명령어

#### `npm run update`
```bash
npm run update
```
- **실행 파일**: `node config/update.js`
- **기능**: 프로젝트 의존성을 최신 버전으로 업데이트
- **사용 시점**: 정기적인 패키지 업데이트 시
- **주의사항**: 호환성 문제가 발생할 수 있으니 테스트 환경에서 먼저 실행

#### `npm run reinstall`
```bash
npm run reinstall
```
- **실행 파일**: `node config/update.js -l -g`
- **기능**: 모든 `node_modules` 삭제 후 재설치 (로컬, 글로벌)
- **사용 시점**: 의존성 충돌이나 설치 문제 발생 시
- **옵션**:
  - `-l`: 로컬 패키지 재설치
  - `-g`: 글로벌 패키지도 함께 처리

#### Bun 버전 명령어들
```bash
npm run b:reinstall        # Bun으로 재설치
npm run reinstall:docker   # Docker 환경에서 재설치
npm run update:local       # 로컬만 업데이트
npm run update:docker      # Docker 환경 업데이트
```

### 👥 사용자 관리 명령어

#### `npm run create-user`
```bash
npm run create-user
```
- **실행 파일**: `node config/create-user.js`
- **기능**: 새 사용자 계정 생성
- **사용법**: 대화형 프롬프트로 사용자 정보 입력
- **예시**:
```bash
npm run create-user
# 프롬프트에서 이메일, 패스워드, 이름 입력
```

#### `npm run invite-user`
```bash
npm run invite-user -- --email user@example.com
```
- **실행 파일**: `node config/invite-user.js`
- **기능**: 사용자 초대 이메일 발송
- **옵션**: `--email` 초대할 이메일 주소 지정

#### `npm run ban-user`
```bash
npm run ban-user -- --email user@example.com
```
- **실행 파일**: `node config/ban-user.js`
- **기능**: 특정 사용자 계정 차단
- **사용법**: 이메일 주소로 사용자 지정

#### `npm run delete-user`
```bash
npm run delete-user -- --email user@example.com
```
- **실행 파일**: `node config/delete-user.js`
- **기능**: 사용자 계정 완전 삭제
- **주의**: 되돌릴 수 없는 작업

### 💰 잔액 관리 명령어

#### `npm run add-balance`
```bash
npm run add-balance -- --email user@example.com --amount 100
```
- **실행 파일**: `node config/add-balance.js`
- **기능**: 사용자 토큰 잔액 추가
- **옵션**:
  - `--email`: 사용자 이메일
  - `--amount`: 추가할 잔액

#### `npm run set-balance`
```bash
npm run set-balance -- --email user@example.com --balance 500
```
- **실행 파일**: `node config/set-balance.js`
- **기능**: 사용자 잔액을 특정 값으로 설정
- **차이점**: `add-balance`는 추가, `set-balance`는 설정

#### `npm run list-balances`
```bash
npm run list-balances
```
- **실행 파일**: `node config/list-balances.js`
- **기능**: 모든 사용자의 잔액 목록 조회
- **출력**: 이메일별 현재 잔액 표시

### 🖥️ 서버 실행 명령어

#### `npm run backend`
```bash
npm run backend
```
- **실행 파일**: `cross-env NODE_ENV=production node api/server/index.js`
- **기능**: 프로덕션 모드로 백엔드 서버 실행
- **포트**: 기본 3080 (PORT 환경변수로 변경 가능)

#### `npm run backend:dev`
```bash
npm run backend:dev
```
- **실행 파일**: `cross-env NODE_ENV=development npx nodemon api/server/index.js`
- **기능**: 개발 모드로 백엔드 서버 실행 (자동 재시작)
- **특징**: 파일 변경시 자동으로 서버 재시작

#### `npm run backend:stop`
```bash
npm run backend:stop
```
- **실행 파일**: `node config/stop-backend.js`
- **기능**: 실행 중인 백엔드 서버 중지

### 📦 패키지 빌드 명령어 (중요!)

#### 패키지 빌드 순서 (반드시 순서대로 실행)
```bash
# 1단계: 데이터 스키마 빌드
npm run build:data-schemas
```
- **실행 위치**: `cd packages/data-schemas && npm run build`
- **기능**: MongoDB 스키마와 TypeScript 타입 정의 빌드
- **중요도**: ⭐⭐⭐ (가장 먼저 실행해야 함)

```bash
# 2단계: 데이터 프로바이더 빌드  
npm run build:data-provider
```
- **실행 위치**: `cd packages/data-provider && npm run build`
- **기능**: API 통신 라이브러리 빌드
- **의존성**: data-schemas에 의존

```bash
# 3단계: API 패키지 빌드
npm run build:api
```
- **실행 위치**: `cd packages/api && npm run build`
- **기능**: 백엔드 공통 로직 빌드
- **의존성**: data-schemas에 의존

```bash
# 4단계: 클라이언트 패키지 빌드
npm run build:client-package
```
- **실행 위치**: `cd packages/client && npm run build`
- **기능**: 공통 UI 컴포넌트 라이브러리 빌드
- **의존성**: 모든 이전 패키지에 의존

### 🎨 프론트엔드 빌드 명령어

#### `npm run frontend`
```bash
npm run frontend
```
- **전체 프로세스**: 
  1. `npm run build:data-provider`
  2. `npm run build:data-schemas`
  3. `npm run build:api` 
  4. `npm run build:client-package`
  5. `cd client && npm run build`
- **기능**: 프로덕션용 프론트엔드 빌드
- **결과물**: `client/dist/` 폴더에 정적 파일 생성

#### `npm run frontend:dev`
```bash
npm run frontend:dev
```
- **기능**: 개발 서버 시작 (패키지 빌드 포함)
- **특징**: HMR(Hot Module Replacement) 지원
- **주소**: http://localhost:3080

#### `npm run frontend:ci`
```bash
npm run frontend:ci
```
- **기능**: CI 환경용 프론트엔드 빌드
- **특징**: 개발 모드이지만 최적화된 빌드

### 🧪 테스트 명령어

#### `npm run test:client`
```bash
npm run test:client
```
- **실행 위치**: `cd client && npm run test:ci`
- **기능**: 프론트엔드 유닛 테스트 실행
- **테스트 프레임워크**: Jest + React Testing Library

#### `npm run test:api`  
```bash
npm run test:api
```
- **실행 위치**: `cd api && npm run test:ci`
- **기능**: 백엔드 테스트 실행
- **포함**: API 엔드포인트, 모델, 유틸 함수 테스트

#### End-to-End 테스트
```bash
npm run e2e              # 로컬 E2E 테스트
npm run e2e:headed       # UI 표시하며 테스트
npm run e2e:a11y         # 접근성 테스트  
npm run e2e:debug        # 디버그 모드
```

### 🔍 코드 품질 명령어

#### `npm run lint`
```bash
npm run lint
```
- **실행**: `eslint "{,!(node_modules|venv)/**/}*.{js,jsx,ts,tsx}"`
- **기능**: 모든 JavaScript/TypeScript 파일 린트 검사
- **설정**: `eslint.config.mjs` 파일 참조

#### `npm run lint:fix`
```bash
npm run lint:fix
```
- **기능**: 자동으로 고칠 수 있는 린트 에러 수정
- **사용 시점**: 코드 정리할 때

#### `npm run format`
```bash
npm run format
```
- **실행**: `npx prettier --write "{,!(node_modules|venv)/**/}*.{js,jsx,ts,tsx}"`
- **기능**: Prettier로 코드 포맷팅
- **설정**: `.prettierrc` 파일 참조

### 🐳 Docker 관련 명령어

#### `npm run start:deployed`
```bash
npm run start:deployed
```
- **실행**: `docker compose -f ./deploy-compose.yml up -d`
- **기능**: 프로덕션용 Docker Compose 시작
- **설정 파일**: `deploy-compose.yml`

#### `npm run stop:deployed`
```bash
npm run stop:deployed
```
- **기능**: 프로덕션 Docker 컨테이너 중지

### 🔧 유지보수 명령어

#### `npm run flush-cache`
```bash
npm run flush-cache
```
- **실행 파일**: `node config/flush-cache.js`
- **기능**: Redis 캐시 전체 삭제
- **사용 시점**: 캐시 문제로 인한 오작동 시

#### `npm run reset-meili-sync`
```bash
npm run reset-meili-sync
```
- **실행 파일**: `node config/reset-meili-sync.js`
- **기능**: MeiliSearch 인덱스 초기화
- **사용 시점**: 검색 기능 문제 발생 시

## 🚀 일반적인 개발 워크플로우

### 🏁 처음 시작할 때
```bash
# 1. 의존성 설치
npm install

# 2. 환경변수 설정
cp .env.example .env
# .env 파일 편집

# 3. 패키지 빌드 (순서 중요!)
npm run build:data-schemas
npm run build:data-provider
npm run build:api
npm run build:client-package

# 4. 개발 서버 시작
npm run backend:dev      # 터미널 1
npm run frontend:dev     # 터미널 2
```

### 🔄 일반적인 개발 사이클
```bash
# 1. 코드 수정 후 테스트
npm run test:client
npm run test:api

# 2. 코드 품질 검사
npm run lint:fix
npm run format

# 3. 빌드 테스트
npm run frontend

# 4. E2E 테스트 (선택사항)
npm run e2e
```

### 🐛 문제 해결할 때
```bash
# 1. 빌드 문제 발생시
npm run reinstall
npm run build:data-schemas
npm run build:data-provider
npm run build:api
npm run build:client-package

# 2. 캐시 문제 발생시
npm run flush-cache

# 3. 검색 문제 발생시
npm run reset-meili-sync
```

## 📝 Bun 명령어들

LibreChat은 npm 외에도 Bun 패키지 매니저를 지원합니다:

```bash
npm run b:api            # Bun으로 백엔드 실행
npm run b:client:dev     # Bun으로 프론트엔드 개발 서버
npm run b:test:client    # Bun으로 클라이언트 테스트
npm run b:test:api       # Bun으로 API 테스트
```

## ⚠️ 주의사항

1. **패키지 빌드 순서**: 반드시 의존성 순서대로 빌드해야 함
2. **환경변수**: 실행 전 `.env` 파일 설정 필수
3. **포트 충돌**: 기본 포트 3080이 사용중이면 PORT 환경변수로 변경
4. **권한 문제**: 일부 명령어는 관리자 권한 필요할 수 있음
5. **Docker 메모리**: Docker 실행시 충분한 메모리 할당 필요

이 가이드를 참고하여 LibreChat 개발을 효율적으로 진행하세요!