# Docker ë°°í¬ ê°€ì´ë“œ

LibreChatì„ Dockerë¡œ ì‹¤ì„œë²„(3090 ì„œë²„)ì— ë°°í¬í•˜ê³  í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ìƒì„¸ ê°€ì´ë“œì…ë‹ˆë‹¤.

## ğŸ³ Docker ê¸°ë³¸ êµ¬ì¡°

LibreChatì€ ë‹¤ìŒ Docker ì„œë¹„ìŠ¤ë“¤ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤:

```yaml
services:
  api:           # LibreChat ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜
  mongodb:       # ë°ì´í„°ë² ì´ìŠ¤
  meilisearch:   # ê²€ìƒ‰ ì—”ì§„
  vectordb:      # ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤
  rag_api:       # RAG (Retrieval Augmented Generation) API
```

## ğŸš€ í”„ë¡ íŠ¸ì—”ë“œ ë³€ê²½ í›„ ì‹¤ì„œë²„ ë°°í¬ ê³¼ì •

### 1. ë¡œì»¬ì—ì„œ ë³€ê²½ì‚¬í•­ ê°œë°œ (Yarn ì›Œí¬ìŠ¤í˜ì´ìŠ¤)

```bash
# 1. ì˜ì¡´ì„± ì„¤ì¹˜
yarn install

# 2. íŒ¨í‚¤ì§€ ë¹Œë“œ (ìˆœì„œ ì¤‘ìš”!)
yarn build:data-schemas
yarn build:data-provider
yarn build:api
yarn build:client-package

# 3. í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ (ë¡œì»¬)
yarn frontend:dev

# 4. ë³€ê²½ì‚¬í•­ í…ŒìŠ¤íŠ¸
yarn test:client

# 5. ë¹Œë“œ í…ŒìŠ¤íŠ¸
yarn frontend
```

### 2. Docker ì´ë¯¸ì§€ ë¹Œë“œ

**ë°©ë²• A: ë¡œì»¬ ë¹Œë“œ (Yarn í¬í•¨)**
```bash
# Yarn Berry í¬í•¨ Dockerfile ë¹Œë“œ
docker build -t librechat-custom:latest .

# ë˜ëŠ” docker-composeë¡œ ë¹Œë“œ
docker-compose build api

# ë¹Œë“œ ì „ ë¡œì»¬ì—ì„œ íŒ¨í‚¤ì§€ ë¹Œë“œ í™•ì¸
yarn workspaces foreach --parallel run build
```

**ë°©ë²• B: ê³µì‹ ì´ë¯¸ì§€ ì‚¬ìš© (ê¶Œì¥)**
```bash
# docker-compose.ymlì—ì„œ ê³µì‹ ì´ë¯¸ì§€ ì‚¬ìš©
image: ghcr.io/danny-avila/librechat-dev:latest
```

### 3. 3090 ì„œë²„ ë°°í¬

**ì„œë²„ ì ‘ì† ë° ë°°í¬:**
```bash
# 3090 ì„œë²„ ì ‘ì† (ì˜ˆì‹œ)
ssh user@3090-server-ip

# LibreChat ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd /path/to/LibreChat

# ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì¤‘ì§€
docker-compose down

# ìµœì‹  ì´ë¯¸ì§€ ê°€ì ¸ì˜¤ê¸° (ê³µì‹ ì´ë¯¸ì§€ ì‚¬ìš©ì‹œ)
docker-compose pull

# ìƒˆë¡œìš´ ì»¨í…Œì´ë„ˆ ì‹œì‘
docker-compose up -d

# ë˜ëŠ” ë°°í¬ìš© compose íŒŒì¼ ì‚¬ìš©
docker-compose -f deploy-compose.yml up -d
```

### 4. ë°°í¬ í™•ì¸

```bash
# ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
docker-compose ps

# ë¡œê·¸ í™•ì¸
docker-compose logs -f api

# íŠ¹ì • ì„œë¹„ìŠ¤ ë¡œê·¸
docker-compose logs -f mongodb
docker-compose logs -f meilisearch

# í—¬ìŠ¤ì²´í¬
curl http://localhost:3080/health
```

## âš™ï¸ í™˜ê²½ ì„¤ì •

### .env íŒŒì¼ ì„¤ì • (ì¤‘ìš”!)

```bash
# .env íŒŒì¼ ì˜ˆì‹œ (3090 ì„œë²„ìš©)
PORT=3080
HOST=0.0.0.0

# MongoDB ì„¤ì •
MONGO_URI=mongodb://mongodb:27017/LibreChat

# ê²€ìƒ‰ ì„¤ì •
MEILI_HOST=http://meilisearch:7700
MEILI_MASTER_KEY=your_secret_key

# AI API í‚¤ë“¤
OPENAI_API_KEY=your_openai_key
ANTHROPIC_API_KEY=your_anthropic_key

# íŒŒì¼ ì—…ë¡œë“œ ì„¤ì •
FILE_UPLOAD_PATH=/app/uploads

# ë„ì»¤ ì‚¬ìš©ì ì„¤ì •
UID=1000
GID=1000
```

### docker-compose.override.yml ì„¤ì •

```yaml
# docker-compose.override.yml
version: '3.8'

services:
  api:
    ports:
      - "3080:3080"  # í¬íŠ¸ ë§¤í•‘ ì¡°ì •
    environment:
      - NODE_ENV=production
      - DEBUG=false
    volumes:
      - ./custom-config:/app/config  # ì»¤ìŠ¤í…€ ì„¤ì • ë§ˆìš´íŠ¸
      
  mongodb:
    ports:
      - "27017:27017"  # ì™¸ë¶€ ì ‘ê·¼ í—ˆìš© (ê°œë°œì‹œë§Œ)
    
  meilisearch:
    ports:
      - "7700:7700"   # ê²€ìƒ‰ API ì™¸ë¶€ ì ‘ê·¼
```

## ğŸ” ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§

### 1. ì»¨í…Œì´ë„ˆ ìƒíƒœ ëª¨ë‹ˆí„°ë§

```bash
# ì‹¤ì‹œê°„ ìƒíƒœ í™•ì¸
watch docker-compose ps

# ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ í™•ì¸
docker stats

# íŠ¹ì • ì»¨í…Œì´ë„ˆ ìƒì„¸ ì •ë³´
docker inspect librechat_api_1
```

### 2. ë¡œê·¸ ëª¨ë‹ˆí„°ë§

```bash
# ì‹¤ì‹œê°„ ë¡œê·¸ ì¶”ì 
docker-compose logs -f --tail=100 api

# ì—ëŸ¬ ë¡œê·¸ë§Œ í•„í„°ë§
docker-compose logs api | grep -i error

# ë¡œê·¸ íŒŒì¼ë¡œ ì €ì¥
docker-compose logs api > /tmp/librechat.log
```

### 3. ì• í”Œë¦¬ì¼€ì´ì…˜ ëª¨ë‹ˆí„°ë§

```bash
# API í—¬ìŠ¤ì²´í¬
curl -f http://localhost:3080/health || echo "API Down!"

# ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í™•ì¸
docker exec -it chat-mongodb mongosh --eval "db.adminCommand('ping')"

# MeiliSearch ìƒíƒœ í™•ì¸
curl http://localhost:7700/health
```

## ğŸ”„ ì—…ë°ì´íŠ¸ í”„ë¡œì„¸ìŠ¤

### 1. ë¬´ì¤‘ë‹¨ ë°°í¬ (Blue-Green ë°©ì‹)

```bash
# 1. ìƒˆ ë²„ì „ ì´ë¯¸ì§€ ì¤€ë¹„
docker-compose pull

# 2. ê¸°ì¡´ ì„œë¹„ìŠ¤ì™€ ë³‘ë ¬ë¡œ ìƒˆ ì„œë¹„ìŠ¤ ì‹œì‘ (í¬íŠ¸ ë³€ê²½)
# docker-compose.override.ymlì—ì„œ í¬íŠ¸ë¥¼ 3081ë¡œ ë³€ê²½ í›„
docker-compose up -d --scale api=2

# 3. ìƒˆ ë²„ì „ í…ŒìŠ¤íŠ¸
curl http://localhost:3081/health

# 4. ë¡œë“œë°¸ëŸ°ì„œì—ì„œ íŠ¸ë˜í”½ ì „í™˜ (nginx ë“±)
# ë˜ëŠ” í¬íŠ¸ë¥¼ ë‹¤ì‹œ 3080ìœ¼ë¡œ ë³€ê²½

# 5. ê¸°ì¡´ ë²„ì „ ì¢…ë£Œ
docker-compose down --remove-orphans
```

### 2. ê°„ë‹¨í•œ ì—…ë°ì´íŠ¸

```bash
# ìŠ¤í¬ë¦½íŠ¸ë¡œ ìë™í™” (update.sh)
#!/bin/bash

echo "Stopping LibreChat..."
docker-compose down

echo "Pulling latest image..."
docker-compose pull

echo "Starting LibreChat..."
docker-compose up -d

echo "Checking health..."
sleep 30
curl -f http://localhost:3080/health && echo "âœ… Update successful!" || echo "âŒ Update failed!"
```

## ğŸ› ï¸ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 1. ì»¨í…Œì´ë„ˆ ì‹œì‘ ì‹¤íŒ¨

```bash
# 1. í¬íŠ¸ ì¶©ëŒ í™•ì¸
netstat -tulpn | grep :3080

# 2. ë³¼ë¥¨ ê¶Œí•œ í™•ì¸
ls -la ./uploads ./data-node

# 3. í™˜ê²½ë³€ìˆ˜ í™•ì¸
docker-compose config

# 4. ì»¨í…Œì´ë„ˆ ê°•ì œ ì¬ìƒì„±
docker-compose down -v
docker-compose up -d --force-recreate
```

### 2. ë¹Œë“œ ì—ëŸ¬ í•´ê²°

```bash
# 1. Docker ìºì‹œ í´ë¦¬ì–´
docker system prune -a

# 2. ë¹Œë“œ ìºì‹œ ì—†ì´ ì¬ë¹Œë“œ
docker-compose build --no-cache api

# 3. Base ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
docker pull node:18-alpine
```

### 3. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ë¬¸ì œ

```bash
# MongoDB ì—°ê²° í…ŒìŠ¤íŠ¸
docker exec -it chat-mongodb mongosh --eval "db.runCommand({connectionStatus: 1})"

# ë„¤íŠ¸ì›Œí¬ í™•ì¸
docker network ls
docker network inspect librechat_default
```

### 4. ì„±ëŠ¥ ì´ìŠˆ

```bash
# ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸
docker stats --no-stream

# ì»¨í…Œì´ë„ˆ ì œí•œ ì„¤ì • (docker-compose.yml)
services:
  api:
    deploy:
      resources:
        limits:
          memory: 2G
          cpus: '1.0'
```

## ğŸ“Š ë¡œê·¸ ë¶„ì„

### ì¤‘ìš” ë¡œê·¸ íŒ¨í„´

```bash
# ì„±ê³µì ì¸ ì‹œì‘
docker-compose logs api | grep "Server listening"

# ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
docker-compose logs api | grep "Connected to MongoDB"

# API ì—ëŸ¬
docker-compose logs api | grep -E "(ERROR|error|Error)"

# ë©”ëª¨ë¦¬ ê´€ë ¨ ì´ìŠˆ
docker-compose logs api | grep -i "memory"
```

## ğŸ” ë³´ì•ˆ ì„¤ì •

### í”„ë¡œë•ì…˜ ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸

```bash
# 1. ê¸°ë³¸ íŒ¨ìŠ¤ì›Œë“œ ë³€ê²½
MEILI_MASTER_KEY=strong_random_key

# 2. MongoDB ì¸ì¦ í™œì„±í™”
# docker-compose.ymlì—ì„œ --noauth ì œê±°

# 3. ë°©í™”ë²½ ì„¤ì •
ufw allow 3080/tcp
ufw deny 27017/tcp  # MongoDB ì™¸ë¶€ ì ‘ê·¼ ì°¨ë‹¨

# 4. SSL/TLS ì„¤ì • (nginx proxy ê¶Œì¥)
```

## ğŸ“‹ ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

âœ… **ë°°í¬ ì „ ì²´í¬:**
- [ ] ë¡œì»¬ í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- [ ] í™˜ê²½ë³€ìˆ˜ ì„¤ì • í™•ì¸
- [ ] ë³¼ë¥¨ ë§ˆìš´íŠ¸ ê²½ë¡œ í™•ì¸
- [ ] í¬íŠ¸ ì¶©ëŒ ì—†ìŒ

âœ… **ë°°í¬ í›„ ì²´í¬:**
- [ ] ì»¨í…Œì´ë„ˆ ì •ìƒ ì‹¤í–‰ í™•ì¸
- [ ] í—¬ìŠ¤ì²´í¬ í†µê³¼
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í™•ì¸
- [ ] ë¡œê·¸ ì—ëŸ¬ ì—†ìŒ
- [ ] í”„ë¡ íŠ¸ì—”ë“œ ì •ìƒ ë¡œë”©

ì´ ê°€ì´ë“œë¥¼ ë”°ë¼í•˜ë©´ í”„ë¡ íŠ¸ì—”ë“œ ë³€ê²½ì‚¬í•­ì„ 3090 ì„œë²„ì— ì•ˆì „í•˜ê²Œ ë°°í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.