# ë¹Œë“œ ë¬¸ì œ í•´ê²° ê°€ì´ë“œ

LibreChatì—ì„œ ë²„ì „ ì°¨ì´ë¡œ ì¸í•œ ë¹Œë“œ ë¬¸ì œì™€ ê·¸ í•´ê²° ë°©ë²•ì— ëŒ€í•œ ì¢…í•©ì ì¸ ê°€ì´ë“œì…ë‹ˆë‹¤.

## ğŸš¨ ì£¼ìš” ë¹Œë“œ ë¬¸ì œë“¤

### 1. íŒ¨í‚¤ì§€ ì˜ì¡´ì„± ë¬¸ì œ

**ì¦ìƒ:**
```bash
Error: Cannot resolve module '@librechat/data-provider'
Error: Module not found: Can't resolve '@librechat/client'
npm ERR! peer dep missing: react@^18.0.0
```

**ì›ì¸:** 
- íŒ¨í‚¤ì§€ ë¹Œë“œê°€ ë˜ì§€ ì•Šì•„ì„œ ë°œìƒ
- ì˜ì¡´ì„± ë²„ì „ ë¶ˆì¼ì¹˜
- ëª¨ë…¸ë ˆí¬ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì„¤ì • ë¬¸ì œ

**í•´ê²°ë°©ë²• (Yarn Berry ì›Œí¬ìŠ¤í˜ì´ìŠ¤):**
```bash
# 1. ëª¨ë“  ì›Œí¬ìŠ¤í˜ì´ìŠ¤ í´ë¦° ì„¤ì¹˜
rm -rf node_modules */node_modules packages/*/node_modules
rm -rf .yarn/cache .yarn/install-state.gz
rm -f yarn.lock package-lock.json  # ì¶©ëŒ ë°©ì§€

# 2. Yarnìœ¼ë¡œ ì¬ì„¤ì¹˜
yarn install

# 3. íŒ¨í‚¤ì§€ë“¤ì„ ì˜ì¡´ì„± ìˆœì„œëŒ€ë¡œ ë¹Œë“œ
yarn build:data-schemas      # 1ìˆœìœ„: ìŠ¤í‚¤ë§ˆ
yarn build:data-provider     # 2ìˆœìœ„: API í´ë¼ì´ì–¸íŠ¸  
yarn build:api               # 3ìˆœìœ„: ë°±ì—”ë“œ ê³µí†µ ë¡œì§
yarn build:client-package    # 4ìˆœìœ„: UI ì»´í¬ë„ŒíŠ¸

# 4. ë˜ëŠ” ë³‘ë ¬ë¡œ ë¹Œë“œ (ì˜ì¡´ì„± ìë™ ê´€ë¦¬)
yarn workspaces foreach --topological run build

# 5. í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ
yarn frontend
```

### 2. Node.js ë²„ì „ í˜¸í™˜ì„± ë¬¸ì œ

**ì¦ìƒ:**
```bash
Error: The engine "node" is incompatible with this module
digital envelope routines::unsupported
```

**ì›ì¸:** Node.js ë²„ì „ì´ í”„ë¡œì íŠ¸ ìš”êµ¬ì‚¬í•­ê³¼ ë§ì§€ ì•ŠìŒ

**í•´ê²°ë°©ë²•:**
```bash
# 1. í˜„ì¬ Node.js ë²„ì „ í™•ì¸
node --version

# 2. ê¶Œì¥ Node.js ë²„ì „ìœ¼ë¡œ ë³€ê²½ (18.x LTS)
# nvm ì‚¬ìš©ì‹œ:
nvm install 18
nvm use 18

# 3. Yarnë„ ìµœì‹  ë²„ì „ìœ¼ë¡œ ì—…ë°ì´íŠ¸
npm install -g yarn
yarn set version 4.9.4

# 4. ì¬ë¹Œë“œ
yarn build:data-provider
```

### 3. TypeScript ì»´íŒŒì¼ ì—ëŸ¬

**ì¦ìƒ:**
```bash
TS2307: Cannot find module '@librechat/data-schemas' or its corresponding type declarations
TS2322: Type 'string' is not assignable to type 'never'
```

**í•´ê²°ë°©ë²•:**
```bash
# 1. TypeScript ìºì‹œ í´ë¦¬ì–´
rm -rf client/node_modules/.cache
rm -rf packages/*/dist
rm -rf packages/*/node_modules/.cache

# 2. íƒ€ì… ì •ì˜ ì¬ìƒì„± (ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë°©ì‹)
yarn workspace @librechat/data-schemas build
yarn workspace librechat-data-provider build

# ë˜ëŠ” ì˜ì¡´ì„± ìˆœì„œëŒ€ë¡œ
yarn build:data-schemas
yarn build:data-provider

# 3. TypeScript ì„¤ì • ê²€ì¦
yarn workspace client typecheck
# ë˜ëŠ” ì§ì ‘ ì‹¤í–‰
cd client
yarn tsc --noEmit
```

### 4. Vite ë¹Œë“œ ë¬¸ì œ

**ì¦ìƒ:**
```bash
[vite]: Rollup failed to resolve import
Cannot access '__VITE_IS_LEGACY__' before initialization
```

**í•´ê²°ë°©ë²•:**
```bash
# 1. Vite ìºì‹œ í´ë¦¬ì–´
cd client
rm -rf node_modules/.vite
rm -rf dist

# 2. í™˜ê²½ë³€ìˆ˜ í™•ì¸
cp .env.example .env
# NODE_ENV=developmentë¡œ ì„¤ì •

# 3. Vite ì„¤ì • ë””ë²„ê·¸
npm run build:file
# ë˜ëŠ” ë””ë²„ê·¸ ëª¨ë“œë¡œ
DEBUG=vite:* npm run dev
```

### 5. Webpack/Babel ì„¤ì • ì¶©ëŒ

**ì¦ìƒ:**
```bash
Module parse failed: Unexpected token
Support for the experimental syntax 'jsx' isn't currently enabled
```

**í•´ê²°ë°©ë²•:**
```bash
# 1. Babel ì„¤ì • í™•ì¸
cd client
cat babel.config.cjs

# 2. í•„ìš”ì‹œ .babelrc ì‚­ì œ (babel.config.cjs ìš°ì„ )
rm -f .babelrc .babelrc.json

# 3. JSX preset ì„¤ì¹˜ í™•ì¸
npm list @babel/preset-react
```

## ğŸ”§ ë²„ì „ë³„ í•´ê²°ì±…

### React 19 ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ìŠˆ

**ìƒˆë¡œìš´ React 19 ê¸°ëŠ¥ ì‚¬ìš©ì‹œ:**
```bash
# 1. React 19 í˜¸í™˜ íŒ¨í‚¤ì§€ë¡œ ì—…ë°ì´íŠ¸
npm install react@^19.0.0 react-dom@^19.0.0
npm install @types/react@^19.0.0 @types/react-dom@^19.0.0

# 2. í˜¸í™˜ë˜ì§€ ì•ŠëŠ” íŒ¨í‚¤ì§€ í™•ì¸
npm ls --depth=0 | grep "UNMET PEER DEPENDENCY"

# 3. í•„ìš”ì‹œ ì˜¤ë²„ë¼ì´ë“œ ì„¤ì • (package.json)
"overrides": {
  "react": "^19.0.0",
  "react-dom": "^19.0.0"
}
```

### ESLint 9.x ë§ˆì´ê·¸ë ˆì´ì…˜

**ESLint ì„¤ì • ë¬¸ì œ:**
```bash
# ê¸°ì¡´ .eslintrc.js ë¥¼ eslint.config.mjs ë¡œ ë³€í™˜ í•„ìš”

# 1. í˜„ì¬ ESLint ì„¤ì • ê²€ì¦
npx eslint --print-config client/src/App.jsx

# 2. ìƒˆ ì„¤ì • íŒŒì¼ ì‚¬ìš© í™•ì¸
cat eslint.config.mjs
```

### Yarn vs NPM í˜¼ìš© ë¬¸ì œ

**Lock íŒŒì¼ ì¶©ëŒ:**
```bash
# 1. í•˜ë‚˜ì˜ íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €ë§Œ ì‚¬ìš© ê²°ì •
# yarn ì‚¬ìš©ì‹œ:
rm -f package-lock.json
yarn install

# npm ì‚¬ìš©ì‹œ:
rm -f yarn.lock
npm install

# 2. .gitignoreì— ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” lock íŒŒì¼ ì¶”ê°€
echo "package-lock.json" >> .gitignore  # yarn ì‚¬ìš©ì‹œ
echo "yarn.lock" >> .gitignore          # npm ì‚¬ìš©ì‹œ
```

## ğŸ› ï¸ ì²´ê³„ì ì¸ ë¬¸ì œ í•´ê²° í”„ë¡œì„¸ìŠ¤

### 1ë‹¨ê³„: í™˜ê²½ ì •ë¦¬

```bash
#!/bin/bash
# clean-build.sh

echo "ğŸ§¹ Cleaning build environment..."

# ëª¨ë“  node_modules ì‚­ì œ
find . -name "node_modules" -type d -prune -exec rm -rf {} +

# Lock íŒŒì¼ë“¤ ì‚­ì œ
rm -f package-lock.json yarn.lock
find . -name "package-lock.json" -delete
find . -name "yarn.lock" -delete

# ë¹Œë“œ ê²°ê³¼ë¬¼ ì‚­ì œ
rm -rf client/dist
rm -rf packages/*/dist
rm -rf api/logs/*

# ìºì‹œ ì‚­ì œ
rm -rf ~/.npm/_cacache
rm -rf ~/.cache/yarn

echo "âœ… Environment cleaned!"
```

### 2ë‹¨ê³„: ìˆœì°¨ì  ë¹Œë“œ

```bash
#!/bin/bash
# sequential-build.sh

echo "ğŸ“¦ Starting sequential build process..."

# 1. ë£¨íŠ¸ ì˜ì¡´ì„± ì„¤ì¹˜
echo "Installing root dependencies..."
npm install

# 2. ìŠ¤í‚¤ë§ˆ ë¹Œë“œ (ìµœìš°ì„ )
echo "Building data schemas..."
npm run build:data-schemas
if [ $? -ne 0 ]; then
    echo "âŒ Data schemas build failed!"
    exit 1
fi

# 3. ë°ì´í„° í”„ë¡œë°”ì´ë” ë¹Œë“œ
echo "Building data provider..."
npm run build:data-provider
if [ $? -ne 0 ]; then
    echo "âŒ Data provider build failed!"
    exit 1
fi

# 4. API íŒ¨í‚¤ì§€ ë¹Œë“œ
echo "Building API package..."
npm run build:api
if [ $? -ne 0 ]; then
    echo "âŒ API package build failed!"
    exit 1
fi

# 5. í´ë¼ì´ì–¸íŠ¸ íŒ¨í‚¤ì§€ ë¹Œë“œ
echo "Building client package..."
npm run build:client-package
if [ $? -ne 0 ]; then
    echo "âŒ Client package build failed!"
    exit 1
fi

# 6. ìµœì¢… í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ
echo "Building frontend..."
npm run frontend
if [ $? -ne 0 ]; then
    echo "âŒ Frontend build failed!"
    exit 1
fi

echo "âœ… All builds completed successfully!"
```

### 3ë‹¨ê³„: ê²€ì¦

```bash
#!/bin/bash
# verify-build.sh

echo "ğŸ” Verifying build results..."

# íŒ¨í‚¤ì§€ ì¡´ì¬ í™•ì¸
PACKAGES=(
    "packages/data-schemas/dist"
    "packages/data-provider/dist"  
    "packages/api/dist"
    "packages/client/dist"
    "client/dist"
)

for package in "${PACKAGES[@]}"; do
    if [ -d "$package" ]; then
        echo "âœ… $package exists"
    else
        echo "âŒ $package missing"
        exit 1
    fi
done

# TypeScript íƒ€ì… ì²´í¬
echo "Checking TypeScript types..."
cd client && npm run typecheck
if [ $? -ne 0 ]; then
    echo "âŒ TypeScript check failed!"
    exit 1
fi

echo "âœ… Build verification completed!"
```

## ğŸ› ìì£¼ ë°œìƒí•˜ëŠ” íŠ¹ì • ì—ëŸ¬ë“¤

### `ENOENT` ì—ëŸ¬

```bash
Error: ENOENT: no such file or directory, open 'packages/data-provider/dist/index.js'
```

**í•´ê²°:**
```bash
# data-providerê°€ ë¹Œë“œë˜ì§€ ì•Šì•˜ìŒ
cd packages/data-provider
npm run build
```

### `Cannot find module` ì—ëŸ¬

```bash
Error: Cannot find module '@librechat/data-schemas/types'
```

**í•´ê²°:**
```bash
# í•´ë‹¹ íŒ¨í‚¤ì§€ ì¬ë¹Œë“œ
cd packages/data-schemas
npm run build

# íƒ€ì… ì •ì˜ í™•ì¸
ls -la dist/
```

### `Peer dependency` ê²½ê³ 

```bash
npm WARN peer dep missing: react@^18.0.0, required by some-package@1.0.0
```

**í•´ê²°:**
```bash
# ì •í™•í•œ React ë²„ì „ ì„¤ì¹˜
npm install react@^19.0.0 react-dom@^19.0.0

# ë˜ëŠ” package.jsonì— overrides ì„¤ì •
```

### ë©”ëª¨ë¦¬ ë¶€ì¡± ì—ëŸ¬

```bash
FATAL ERROR: Ineffective mark-compacts near heap limit Allocation failed - JavaScript heap out of memory
```

**í•´ê²°:**
```bash
# Node.js ë©”ëª¨ë¦¬ í•œë„ ì¦ê°€
export NODE_OPTIONS="--max-old-space-size=4096"

# ë˜ëŠ” ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ
NODE_OPTIONS="--max-old-space-size=4096" npm run build
```

## ğŸ“‹ ë¹Œë“œ ë¬¸ì œ ì˜ˆë°© ì²´í¬ë¦¬ìŠ¤íŠ¸

### ê°œë°œ í™˜ê²½ ì„¤ì •
- [ ] Node.js 18.x LTS ì‚¬ìš©
- [ ] í•˜ë‚˜ì˜ íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €ë§Œ ì‚¬ìš© (npm ë˜ëŠ” yarn)
- [ ] .env íŒŒì¼ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •
- [ ] ì ì ˆí•œ ë©”ëª¨ë¦¬ í• ë‹¹

### ë¹Œë“œ í”„ë¡œì„¸ìŠ¤
- [ ] íŒ¨í‚¤ì§€ ë¹Œë“œë¥¼ í”„ë¡ íŠ¸ì—”ë“œë³´ë‹¤ ë¨¼ì € ì‹¤í–‰
- [ ] ì˜ì¡´ì„± ìˆœì„œ ì¤€ìˆ˜ (schemas â†’ provider â†’ api â†’ client)
- [ ] ê° ë‹¨ê³„ë³„ ì„±ê³µ í™•ì¸
- [ ] íƒ€ì… ì²´í¬ í†µê³¼

### ë¬¸ì œ ë°œìƒì‹œ
- [ ] ì—ëŸ¬ ë©”ì‹œì§€ ì „ì²´ í™•ì¸
- [ ] ê´€ë ¨ íŒ¨í‚¤ì§€ë¶€í„° ì¬ë¹Œë“œ
- [ ] ìºì‹œ ì‚­ì œ í›„ ì¬ì‹œë„
- [ ] ë¡œê·¸ íŒŒì¼ í™•ì¸

ì´ ê°€ì´ë“œë¥¼ ë”°ë¼í•˜ë©´ ëŒ€ë¶€ë¶„ì˜ ë¹Œë“œ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¬¸ì œê°€ ì§€ì†ë˜ë©´ íŠ¹ì • ì—ëŸ¬ ë©”ì‹œì§€ì™€ í•¨ê»˜ ì´ìŠˆë¥¼ ì œê¸°í•´ì£¼ì„¸ìš”.